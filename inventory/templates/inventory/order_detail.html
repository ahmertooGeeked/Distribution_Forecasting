{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Print-Specific Styles to hide the sidebar/buttons when printing */
    @media print {
        body * {
            visibility: hidden;
        }
        #invoice-area, #invoice-area * {
            visibility: visible;
        }
        #invoice-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: white !important;
            color: black !important;
            box-shadow: none !important;
            border: none !important;
        }
        .no-print {
            display: none !important;
        }
        /* Ensure table colors print correctly */
        .table-striped>tbody>tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.05) !important;
            -webkit-print-color-adjust: exact;
        }
    }

    .invoice-container {
        max-width: 850px;
        margin: auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-top: 5px solid #4f46e5; /* Nexus Brand Color */
    }

    .invoice-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: #111827;
        letter-spacing: -1px;
        margin-bottom: 0;
    }

    .brand-logo i {
        color: #4f46e5;
    }

    .invoice-meta-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #6b7280;
        font-weight: 700;
        letter-spacing: 0.05em;
        margin-bottom: 2px;
    }

    .invoice-meta-value {
        font-size: 1rem;
        font-weight: 600;
        color: #111827;
    }

    .table-invoice th {
        background-color: #f3f4f6 !important;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        color: #4b5563;
        border-bottom: 2px solid #e5e7eb;
        padding: 12px;
    }

    .table-invoice td {
        padding: 12px;
        vertical-align: middle;
        border-bottom: 1px solid #f3f4f6;
    }

    .total-box {
        background-color: #f9fafb;
        border-radius: 8px;
        padding: 20px;
    }
</style>

<div class="container-fluid mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print" style="max-width: 850px; margin: 0 auto;">
        <a href="{% url 'order_list' %}" class="btn btn-light border shadow-sm">
            <i class="fa-solid fa-arrow-left me-2"></i> Back
        </a>
        <button onclick="window.print()" class="btn btn-primary shadow-sm">
            <i class="fa-solid fa-print me-2"></i> Print Invoice
        </button>
    </div>

    <div id="invoice-area" class="invoice-container">

        <div class="d-flex justify-content-between align-items-start mb-5">
            <div>
                <div class="d-flex align-items-center mb-1 brand-logo">
                    <i class="fa-solid fa-layer-group fa-2x me-2"></i>
                    <h1 class="invoice-title">Nexus</h1>
                </div>
                <p class="text-muted small mb-0">Distribution & Supply Chain Solutions</p>
                <p class="text-muted small">Islamabad, Pakistan</p>
            </div>
            <div class="text-end">
                <h2 class="display-6 fw-bold text-uppercase text-muted opacity-25 mb-2">Invoice</h2>
                <div class="badge bg-light text-dark border p-2 px-3 rounded-pill">
                    Status: <span class="fw-bold text-uppercase {% if order.payment_status == 'Paid' %}text-success{% else %}text-danger{% endif %}">{{ order.payment_status }}</span>
                </div>
            </div>
        </div>

        <hr class="my-4 text-muted opacity-25">

        <div class="row mb-5">
            <div class="col-6">
                <p class="invoice-meta-label">Bill To</p>
                <h5 class="fw-bold text-dark mb-1">{{ order.customer.name }}</h5>
                <p class="text-muted mb-1 small"><i class="fa-solid fa-phone me-1"></i> {{ order.customer.phone }}</p>
                <p class="text-muted small">{{ order.customer.address|default:"No address on file" }}</p>
            </div>
            <div class="col-6 text-end">
                <div class="row">
                    <div class="col-12 mb-3">
                        <p class="invoice-meta-label">Invoice Number</p>
                        <p class="invoice-meta-value">#INV-{{ order.id|stringformat:"04d" }}</p>
                    </div>
                    <div class="col-12 mb-3">
                        <p class="invoice-meta-label">Date Issued</p>
                        <p class="invoice-meta-value">{{ order.date|date:"M d, Y" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <table class="table table-invoice mb-4">
            <thead>
                <tr>
                    <th style="width: 50%;">Item Description</th>
                    <th class="text-center">Qty</th>
                    <th class="text-end">Unit Price</th>
                    <th class="text-end">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        <span class="fw-bold text-dark">{{ item.product.name }}</span>
                        <br>
                        <small class="text-muted">{{ item.product.unit }}</small>
                    </td>
                    <td class="text-center fw-bold">{{ item.quantity }}</td>
                    <td class="text-end">{{ system_settings.currency_symbol }} {{ item.price }}</td>
                    <td class="text-end fw-bold">{{ system_settings.currency_symbol }} {{ item.get_total_price }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="row mt-4 align-items-end">
            <div class="col-7">
                <div class="d-flex align-items-center">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=Invoice-{{ order.id }}-Amt-{{ order.total_amount }}"
                         alt="QR Code" class="border p-1 rounded me-3" style="width: 100px; height: 100px;">

                    <div class="small text-muted">
                        <p class="mb-1 fw-bold text-dark">Scan to Verify</p>
                        <p class="mb-0">Thank you for your business.</p>
                        <p class="mb-0">Please pay within 30 days.</p>
                    </div>
                </div>
            </div>

            <div class="col-5">
                <div class="total-box">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Subtotal</span>
                        <span class="fw-bold">{{ system_settings.currency_symbol }} {{ order.total_amount }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Tax (0%)</span>
                        <span class="fw-bold">{{ system_settings.currency_symbol }} 0.00</span>
                    </div>
                    <hr class="my-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fs-5 fw-bold text-dark">Total Due</span>
                        <span class="fs-4 fw-bold" style="color: #4f46e5;">{{ system_settings.currency_symbol }} {{ order.total_amount }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5 pt-4">
            <div class="col-12 text-center">
                <div style="border-top: 1px solid #e5e7eb; width: 200px; margin: 0 auto; padding-top: 10px;">
                    <p class="small text-muted text-uppercase fw-bold mb-0">Authorized Signature</p>
                </div>
                <p class="small text-muted mt-4">
                    Nexus Distribution Systems &bull; generated on {% now "M d, Y" %}
                </p>
            </div>
        </div>

    </div>
</div>
{% endblock %}
