{% extends 'base.html' %}

{% block content %}
<style>
    /* --- DASHBOARD SPECIFIC STYLES --- */
    .dashboard-container { font-family: 'Inter', sans-serif; }

    /* Clean White Cards */
    .card {
        border: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border-radius: 8px;
        background: white;
        transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-3px); }

    /* Professional Gradients (Blue/Purple based) */
    .bg-gradient-primary { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; }
    .bg-gradient-success { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; }
    .bg-gradient-warning { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; }
    .bg-gradient-info { background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%); color: white; }

    .chart-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        height: 100%;
    }
    .chart-container { position: relative; height: 300px; width: 100%; }
    .display-6 { font-size: 2rem; font-weight: 700; }
</style>

<div class="container-fluid dashboard-container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 fw-bold" style="color: #1e293b;">Overview</h1>
            <p class="text-muted small mb-0">Sales performance & inventory status</p>
        </div>
        <div>
            <a href="{% url 'new_sale' %}" class="btn btn-primary shadow-sm me-2">
                <i class="fa-solid fa-plus"></i> New Sale
            </a>
            <button class="btn btn-light border shadow-sm" onclick="window.print()">
                <i class="fa-solid fa-print"></i> Print
            </button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-gradient-success p-3 text-center h-100 border-0">
                <h6 class="opacity-75 text-uppercase small">Total Revenue</h6>
                <h2 class="display-6 mb-0">${{ total_revenue|floatformat:2 }}</h2>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-gradient-info p-3 text-center h-100 border-0">
                <h6 class="opacity-75 text-uppercase small">Net Income</h6>
                <h2 class="display-6 mb-0">${{ total_profit|floatformat:2 }}</h2>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-gradient-primary p-3 text-center h-100 border-0">
                <h6 class="opacity-75 text-uppercase small">Total Orders</h6>
                <h2 class="display-6 mb-0">{{ total_orders }}</h2>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-gradient-warning p-3 text-center h-100 border-0">
                <h6 class="opacity-75 text-uppercase small">Products</h6>
                <h2 class="display-6 mb-0">{{ total_products }}</h2>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="chart-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold m-0 text-dark">Revenue Trend</h5>
                </div>
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="chart-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold m-0 text-dark">Top Products</h5>
                </div>
                <div class="chart-container">
                    <canvas id="productsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header bg-white py-3 border-bottom">
                    <h5 class="m-0 fw-bold text-dark">Recent Sales</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td class="fw-bold text-primary">#{{ order.id }}</td>
                                <td>{{ order.date_created|date:"M d, Y" }}</td>
                                <td>${{ order.total_price }}</td>
                                <td><span class="badge bg-success bg-opacity-10 text-success border border-success">Completed</span></td>
                                <td><a href="#" class="btn btn-sm btn-light border"><i class="fa-solid fa-eye"></i></a></td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" class="text-center py-4 text-muted">No orders found.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card h-100 border-danger border-opacity-25">
                <div class="card-header bg-danger bg-opacity-10 py-3 border-danger border-opacity-25">
                    <h5 class="m-0 fw-bold text-danger"><i class="fa-solid fa-triangle-exclamation"></i> Low Stock</h5>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        {% for item in low_stock_items %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="fw-bold text-dark">{{ item.name }}</span>
                            <span class="badge bg-danger rounded-pill">{{ item.stock_quantity }} left</span>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-success py-4">
                            <i class="fa-solid fa-check-circle fa-2x mb-2"></i><br>Stock healthy!
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const revenueData = JSON.parse('{{ chart_revenue|safe }}');
        const dateLabels = JSON.parse('{{ chart_dates|safe }}');
        const productNames = JSON.parse('{{ top_product_names|safe }}');
        const productQtys = JSON.parse('{{ top_product_qtys|safe }}');

        // Line Chart (Blue)
        const ctxSales = document.getElementById('salesChart');
        if(ctxSales) {
            new Chart(ctxSales.getContext('2d'), {
                type: 'line',
                data: {
                    labels: dateLabels.length ? dateLabels : ['No Data'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: revenueData.length ? revenueData : [0],
                        borderColor: '#2563eb', // Blue Line
                        backgroundColor: 'rgba(37, 99, 235, 0.1)', // Light Blue Fill
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { borderDash: [2, 4] } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Doughnut Chart (Professional Colors)
        const ctxProducts = document.getElementById('productsChart');
        if(ctxProducts) {
            new Chart(ctxProducts.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: productNames.length ? productNames : ['No Data'],
                    datasets: [{
                        data: productQtys.length ? productQtys : [1],
                        backgroundColor: [
                            '#2563eb', // Primary Blue
                            '#3b82f6', // Lighter Blue
                            '#60a5fa', // Soft Blue
                            '#93c5fd', // Very Light Blue
                            '#cbd5e1'  // Grey
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }
    });
</script>
{% endblock %}
